if(!Function.prototype.bind){Function.prototype.bind=function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e||window,t.concat(Array.prototype.slice.call(arguments)))};r.prototype=this.prototype;i.prototype=new r;return i}}var Spacebrew=Spacebrew||{};var WebSocket=WebSocket||{};var window=window||undefined;var module=module||undefined;if(window){if(!window["getQueryString"]){window.getQueryString=function(e){if(!window.location)return;e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)";var n=new RegExp(t);var r=n.exec(window.location.href);if(r==null)return"";else return r[1]}}}if(!window&&module){WebSocket=require("ws");module.exports={Spacebrew:Spacebrew}}Spacebrew.Client=function(e,t,n,r){var r=r||{};if(e!=undefined){if(toString.call(e)!=="[object String]"){r.port=e.port||undefined;r.debug=e.debug||false;r.reconnect=e.reconnect||false;n=e.description||undefined;t=e.name||undefined;e=e.server||undefined}}this.debug=false;if(window){this.debug=window.getQueryString("debug")==="true"?true:r.debug||false}this.reconnect=r.reconnect||true;this.reconnect_timer=undefined;this.send_interval=16;this.send_blocked=false;this.msg={};this._name=t||"javascript client #";if(window){this._name=window.getQueryString("name")!==""?unescape(window.getQueryString("name")):this._name}this._description=n||"spacebrew javascript client";if(window){this._description=window.getQueryString("description")!==""?unescape(window.getQueryString("description")):this._description}this.server=e||"sandbox.spacebrew.cc";if(window){this.server=window.getQueryString("server")!==""?unescape(window.getQueryString("server")):this.server}this.port=r.port||9e3;if(window){var i=window.getQueryString("port");if(i!==""&&!isNaN(i)){this.port=i}}this.socket=null;this.client_config={name:this._name,description:this._description,publish:{messages:[]},subscribe:{messages:[]},options:{}};this.admin={};this._isConnected=false};Spacebrew.Client.prototype.connect=function(){try{this.socket=new WebSocket("ws://"+this.server+":"+this.port);this.socket.onopen=this._onOpen.bind(this);this.socket.onmessage=this._onMessage.bind(this);this.socket.onclose=this._onClose.bind(this)}catch(e){this._isConnected=false;console.log("[connect:Spacebrew] connection attempt failed")}};Spacebrew.Client.prototype.close=function(){try{if(this._isConnected){this.socket.close();this._isConnected=false;console.log("[close:Spacebrew] closing websocket connection")}}catch(e){this._isConnected=false}};Spacebrew.Client.prototype.onOpen=function(e,t){};Spacebrew.Client.prototype.onClose=function(e,t){};Spacebrew.Client.prototype.onRangeMessage=function(e,t){};Spacebrew.Client.prototype.onBooleanMessage=function(e,t){};Spacebrew.Client.prototype.onStringMessage=function(e,t){};Spacebrew.Client.prototype.onCustomMessage=function(e,t,n){};Spacebrew.Client.prototype.addPublish=function(e,t,n){this.client_config.publish.messages.push({name:e,type:t,"default":n});this.updatePubSub()};Spacebrew.Client.prototype.addSubscribe=function(e,t){this.client_config.subscribe.messages.push({name:e,type:t});this.updatePubSub()};Spacebrew.Client.prototype.updatePubSub=function(){if(this._isConnected){this.socket.send(JSON.stringify({config:this.client_config}))}};Spacebrew.Client.prototype.send=function(e,t,n){var r=this;this.msg={message:{clientName:this._name,name:e,type:t,value:n}};if(!this.send_blocked){this.socket.send(JSON.stringify(this.msg));this.send_blocked=true;this.msg=undefined;setTimeout(function(){r.send_blocked=false;if(r.msg!=undefined){r.send(r.msg.message.name,r.msg.message.type,r.msg.message.value)}},r.send_interval)}};Spacebrew.Client.prototype._onOpen=function(){console.log("[_onOpen:Spacebrew] Spacebrew connection opened, client name is: "+this._name);this._isConnected=true;if(this.admin.active)this.connectAdmin();if(this.reconnect_timer){console.log("[_onOpen:Spacebrew] tearing down reconnect timer");this.reconnect_timer=clearInterval(this.reconnect_timer);this.reconnect_timer=undefined}this.updatePubSub();this.onOpen()};Spacebrew.Client.prototype._onMessage=function(e){var t=JSON.parse(e.data),n,r,i,s;if(t["message"]){n=t.message.name;r=t.message.type;i=t.message.value;if(t.message.clientName)s=t.message.clientName;switch(r){case"boolean":this.onBooleanMessage(n,i=="true");break;case"string":this.onStringMessage(n,i);break;case"range":this.onRangeMessage(n,Number(i));break;default:this.onCustomMessage(n,i,r)}}else{if(this.admin.active){this._handleAdminMessages(t)}}};Spacebrew.Client.prototype._onClose=function(){var e=this;console.log("[_onClose:Spacebrew] Spacebrew connection closed");this._isConnected=false;if(this.admin.active)this.admin.remoteAddress=undefined;if(this.reconnect&&!this.reconnect_timer){console.log("[_onClose:Spacebrew] setting up reconnect timer");this.reconnect_timer=setInterval(function(){if(e.isConnected!=false){e.connect();console.log("[reconnect:Spacebrew] attempting to reconnect to spacebrew")}},5e3)}this.onClose()};Spacebrew.Client.prototype.name=function(e){if(e){if(this._isConnected)return false;this._name=e;if(window){this._name=window.getQueryString("name")!==""?unescape(window.getQueryString("name")):this._name}this.client_config.name=this._name}return this._name};Spacebrew.Client.prototype.description=function(e){if(e){if(this._isConnected)return false;this._description=e||"spacebrew javascript client";if(window){this._description=window.getQueryString("description")!==""?unescape(window.getQueryString("description")):this._description}this.client_config.description=this._description}return this._description};Spacebrew.Client.prototype.isConnected=function(){return this._isConnected};Spacebrew.Client.prototype.extend=function(e){for(var t in e){if(e.hasOwnProperty(t)){this[t]=e[t]}}}